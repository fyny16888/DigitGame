{
  "name": "pomelo-rpc",
  "version": "0.4.10",
  "dependencies": {
    "socket.io": "0.9.16",
    "crc": "0.2.0",
    "socket.io-client": "0.9.16",
    "pomelo-loader": "0.0.6",
    "stream-pkg": "0.0.5",
    "pomelo-logger": "0.1.7",
    "node-uuid": "1.4.0",
    "async": "0.2.10"
  },
  "devDependencies": {
    "mocha": ">=0.0.1",
    "should": ">=0.0.1"
  },
  "gitHead": "3ea7008bb7811e08a53816b04b79ff1064ce0fbc",
  "contributors": [
    {
      "name": "* Yongchang Zhou",
      "email": "changchang005@gmail.com"
    }
  ],
  "readme": "#pomelo-rpc - rpc framework for pomelo\r\n\r\npomelo-rpc is the low level RPC framework for pomelo project. It contains two parts: client and server.\r\n\r\nThe client part generates the RPC client proxy, routes the message to the appropriate remote server and manages the network communications. Support add proxies and remote server information dynamically.\r\n\r\nThe server part exports the remote services, dispatches the remote requests to the services and also manages the network communications.\r\n\r\nAnd the remote service codes would loaded by pomelo-loader module and more details please access this [link](https://github.com/node-pomelo/pomelo-loader).\r\n\r\n+ Tags: node.js\r\n\r\n##Installation\r\n```\r\nnpm install pomelo-rpc\r\n```\r\n\r\n##Usage\r\n###Server\r\n``` javascript\r\nvar Server = require('pomelo-rpc').server;\r\n\r\n// remote service path info list\r\nvar paths = [\r\n  {namespace: 'user', path: __dirname + '/remote/test'}\r\n];\r\n\r\nvar port = 3333;\r\n\r\nvar server = Server.create({paths: paths, port: port});\r\nserver.start();\r\nconsole.log('rpc server started.');\r\n```\r\n\r\n###Client\r\n``` javascript\r\nvar Client = require('pomelo-rpc').client;\r\n\r\n// remote service interface path info list\r\nvar records = [\r\n  {namespace: 'user', serverType: 'test', path: __dirname + '/remote/test'}\r\n];\r\n\r\n// server info list\r\nvar servers = [\r\n  {id: 'test-server-1', serverType: 'test', host: '127.0.0.1', port: 3333}\r\n];\r\n\r\n// route parameter passed to route function\r\nvar routeParam = null;\r\n\r\n// route context passed to route function\r\nvar routeContext = servers;\r\n\r\n// route function to caculate the remote server id\r\nvar routeFunc = function(routeParam, msg, routeContext, cb) {\r\n  cb(null, routeContext[0].id);\r\n};\r\n\r\nvar client = Client.create({routeContext: routeContext, router: routeFunc});\r\n\r\nclient.start(function(err) {\r\n  console.log('rpc client start ok.');\r\n\r\n  client.addProxies(records);\r\n  client.addServers(servers);\r\n\r\n  client.proxies.user.test.service.echo(routeParam, 'hello', function(err, resp) {\r\n    if(err) {\r\n      console.error(err.stack);\r\n    }\r\n    console.log(resp);\r\n  });\r\n});\r\n```\r\n\r\n##Server API\r\n###Server.create(opts)\r\nCreate a RPC server instance. Intitiate the instance and acceptor with the configure.\r\n###Parameters\r\n+ opts.port - rpc server listening port.\r\n+ opts.paths - remote service path infos, format: [{namespace: remote service namespace, path: remote service path}, ...].\r\n+ opts.context - remote service context.\r\n+ opts.acceptorFactory(opts, msgCB) - (optional) acceptor factory method. opts.port：port that acceptor would listen，opts.services：loaded remote services，format: {namespace: {name: service}}. msgCB(msg, cb): remote request arrived callback. the method should return a acceptor instance.\r\n\r\n###server.start\r\nStart the remote server instance.\r\n\r\n###server.stop\r\nStop the remote server instance and the acceptor.\r\n\r\n###Acceptor\r\nImplement the low level network communication with specified protocol. Customize the protocol by passing an acceptorFactory to return different acceptors.\r\n\r\n###acceptor.listen(port)\r\nListen the specified port.\r\n\r\n###acceptor.close\r\nStop the acceptor.\r\n\r\n##Client API\r\n###Client.create(opts)\r\nCreate an RPC client instance which would generate proxies for the RPC client.\r\n####Parameters\r\n+ opts.context - context for mailbox.\r\n+ opts.routeContext - (optional)context for route function.\r\n+ opts.router(routeParam, msg, routeContext, cb) - (optional) route function which decides the RPC message should be send to which remote server. routeParam: route parameter, msg: RPC descriptioin message, routeContext: opts.routeContext.\r\n+ opts.mailBoxFactory(serverInfo, opts) - (optional) mail box factory method.\r\n\r\n###client.addProxies(records)\r\nLoad new proxy codes.\r\n####Parameters\r\n+ records - new proxy code configure information list。Format: [{namespace: service_name_space, serverType: remote_server_type, path: path_to_remote_service_interfaces}];\r\n\r\n###client.addServers(servers)\r\nAdd new remote server informations.\r\n####Parameters\r\n+ servers - remote server information list. Format: [{id: remote_server_id, serverType: remote_server_type, host: remote_server_host, port: remote_server_port}]\r\n\r\n###client.start(cb)\r\nStart the RPC client.\r\n\r\n###client.stop\r\nStop the RPC client and stop all the mail box connections to remote servers.\r\n\r\n###client.rpcInvoke(serverId, msg, cb)\r\nInvoke an RPC request.\r\n####Parameters\r\n+ serverId - remote server id.\r\n+ msg - RPC description message. format: {namespace: remote service namespace, serverType: remote server type, service: remote service name, method: remote service method name, args: remote service args}.\r\n+ cb - remote service callback function.\r\n\r\n###MailBox\r\nImplement the low level network communication with remote server. A mail box instance stands for a remote server. Customize the protocol by passing a mailBoxFactory parameter to client to return different mail box instances.\r\n\r\n###mailbox.connect(cb)\r\nConnect to the remote server.\r\n\r\n###mailbox.close\r\nClose mail box instance and disconnect with the remote server.\r\n\r\n###mailbox.send(msg, opts, cb)\r\nSend the RPC message to the associated remote server.\r\n####Parameters\r\n+ msg - RPC description message, see also clienet.rpcInvoke.\r\n+ opts - reserved.\r\n+ cb - RPC callback function.",
  "readmeFilename": "README.md",
  "description": "pomelo-rpc is the low level RPC framework for pomelo project. It contains two parts: client and server.",
  "_id": "pomelo-rpc@0.4.10",
  "_shasum": "d87a183a32e2596d600f017d8b6616963d719b4b",
  "_from": "rain1017/pomelo-rpc",
  "_resolved": "git://github.com/rain1017/pomelo-rpc.git#3ea7008bb7811e08a53816b04b79ff1064ce0fbc"
}
